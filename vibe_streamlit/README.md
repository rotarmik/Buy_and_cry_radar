# Buy&cry Radar Streamlit demo

Этот проект реализует прототип веб-сервиса, который отображает пайплайн обработки новостей (Router → Validator → Evaluator → Formatter) и позволяет запускать его через интерфейс Streamlit.

## Запуск

```bash
pip install -r requirements.txt  # см. раздел ниже, если файла пока нет
streamlit run app.py
```

> В демо используются статические новости из `buycry_radar/sample_data.py`, поэтому приложение готово к запуску без дополнительных сервисов.

## Архитектура пайплайна

Модули находятся в пакете `buycry_radar`:

- `router.Router` — фан-аут по источникам, фильтрация по интервалу, региону и тикеру.
- `validator.Validator` — скоринг источников и имитация AI-проверки достоверности.
- `evaluator.Evaluator` — дедупликация, расчёт hotness/novelty.
- `formatter.Formatter` — подготовка черновиков постов для соцсетей.
- `pipeline.Pipeline` — оркестратор, возвращает промежуточные результаты через `PipelineRunResult`.

`app.py` поднимает Streamlit UI, позволяет выбрать фильтры и показывает вывод каждого этапа на отдельных вкладках. На вкладке `JSON` можно экспортировать все результаты в виде структуры, близкой к той, что показана в `architecture .docx`.

## Как подключить реальный пайплайн

1. **Источники данных.**
   - Реализуйте классы-коннекторы с методом `fetch(query: RouterQuery) -> list[RawNewsItem]`.
   - Передайте их в `Router(connectors=[...])` и сконструируйте `Pipeline` через `PipelineConfig(router=my_router)`.
2. **AI-валидация.**
   - Внутри `validator.Validator.validate` замените заглушку на вызов LLM/Rule Engine.
   - При возврате `ValidatedNewsItem` заполняйте `ai_validation_score` и `ai_notes` данными модели.
3. **Оценка/ранжирование.**
   - Настройте веса и добавьте собственные метрики в `Evaluator.evaluate`. При интеграции с ML можно обернуть модель в отдельный сервис и вызывать его здесь.
4. **Форматтер.**
   - Подставьте свой генератор текстов/изображений. При необходимости сохраните путь к сгенерированным карточкам в `FormattedPost.hero_image_path`, затем показывайте их в Streamlit через `st.image`.
5. **Внедрение в UI.**
   - Все параметры передаются через `Pipeline.run`. Если нужно больше интерактивности, расширьте форму (например, выбор тематики) и прокиньте значения в ваш Router/Validator.

## Требуемые зависимости

Минимально необходимые пакеты:

```text
streamlit>=1.32
```

При добавлении реальных моделей и коннекторов добавляйте их в `requirements.txt`.

## Дальнейшие шаги

- Подключить хранилище входящих событий вместо `sample_data`.
- Добавить аутентификацию и разграничение доступа к пайплайну.
- Настроить план тестов (юнит тесты для отдельных стадий, интеграционные — для всего пайплайна).
